<!-- https://stackoverflow.com/questions/60518510/collision-with-a-frame-objects-using-javascript-physics-library -->

<html>
  <head>
    <meta charset="utf-8">
    <title>KSA-MT</title>
    <meta name="description" content="KSA-MT">

    
    <!--     Jquery -->
    <script src="https://code.jquery.com/jquery-3.6.0.slim.js" integrity="sha256-HwWONEZrpuoh951cQD1ov2HUK5zA5DwJ1DNUXaM6FsY=" crossorigin="anonymous"></script>
    
  <!--     Adapter.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/adapterjs/0.15.5/adapter.min.js" integrity="sha512-8HaugtT+4c0rhgZIggNCv7I2N0u5OuCXQutD91XdRLqtBl4kD5z2B6QmHczDFMpeENZV060Fip3S954njcfv9A==" crossorigin="anonymous"></script>
    <script src="https://webrtc.github.io/adapter/adapter-latest.js" crossorigin="anonymous"></script>
    

    <script src="https://aframe.io/releases/1.0.3/aframe.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.4.5/socket.io.min.js"></script>
    <script src="easyrtc/easyrtc.js"></script>
<!--     <script src="https://unpkg.com/networked-aframe@^0.6.0/dist/networked-aframe.min.js"></script> -->
<!--     Master repo -->
    <script src="https://cdn.jsdelivr.net/gh/networked-aframe/networked-aframe@master/dist/networked-aframe.min.js" crossorigin="anonymous"></script>

<!--     Detect WebRTC -->
<!--         <script src="https://www.webrtc-experiment.com/DetectRTC.js"></script>
        <script src="https://www.webrtc-experiment.com/CodecsHandler.js"></script>
        <script src="https://conf-tool.glitch.me/conference.js"> </script>
    
        <script src="/js/jsenableChromeAECenableChromeAEC.js"></script> -->
    
    
<!--     Misc... -->
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.1/dist/aframe-extras.min.js"></script>
    <script src="https://unpkg.com/aframe-randomizer-components@^3.0.1/dist/aframe-randomizer-components.min.js"></script>
    <script src="https://unpkg.com/aframe-particle-system-component@1.0.5/dist/aframe-particle-system-component.min.js"></script>
    <script src="/js/spawn-in-circle.component.js"></script>
    
    
    
    <!--Stylesheets -->
    <link href="https://fonts.googleapis.com/css2?family=Overpass:wght@100&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/navbar.css">
    <link rel="stylesheet" href="css/sidebar.css">
    <!-- Add icon library -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    
  </head>
  
  
  <body>
      
    <!--------------------------->
    <!----------- SIDEBAR ----------->
    <!--------------------------->
    
    <div id="gui">
    
      
    </div>
    
    <!--------------------------------->
    <!---------- NAVBAR      ---------->
    <!--------------------------------->
    
      <div class="nav">
  <input type="checkbox" id="nav-check">
  <div class="nav-header">
    <div class="nav-title">
      <img src="https://i.postimg.cc/HsW07YY2/ilearn-removebg-preview-1.png" alt="Tellart" width="auto" height="50%" style="margin-top: 3px;">
    </div>
  </div>
  <div class="nav-btn">
    <label for="nav-check">
      <span></span>
      <span></span>
      <span></span>
    </label>
  </div>
  
  <div class="nav-links">
    
     <a id="location2">Bird View</a>
    <a id="location1">Ground View</a>
    
    
<!--     <a class="toggle-btn">
      <i onclick="micToggle(this)" class="fa fa-microphone"></i>
    </a>
    
    <a class="toggle-spk">
      <i class="fa fa-bullhorn"></i>
    </a>
       -->
    
    
  </div>
</div>  
    
    
    

    <script>
      
      AFRAME.registerComponent('camTexture', {
        schema: {},
        update: function (webcam) {
          
        var webcam = document.querySelector('#webcam');
        this.el.components.material.src = webcam;
        
          
        }
        
      })
      
    
    </script>
    
    
    
    <!--------------------------------->
    <!---------- SCENE SETUP ---------->
    <!--------------------------------->
    <!--     easyrtc; -->
    
    <a-scene id="scene" networked-scene="
      room: audio;
      adapter: easyrtc;
      audio: false;
      video: true;
      debug: true;
      inspector=https://cdn.jsdelivr.net/gh/aframevr/aframe-inspector@master/dist/aframe-inspector.min.js">
      
        <a-sky src="https://cdn.glitch.com/4cfa871f-5082-49ca-9d00-c97e6427df2d%2Fclear-sunny-sky%5B1%5D.jpg"></a-sky>
      
       <a-plane
        position="0 -0.009 0"
        material="color: #FFFFFF;
                         repeat: 1000 1000;
                         src: #ground;
                         normal-image-texture: 1000 1000"
        rotation="-90 0 0"
        scale="1000 1000 1"
      ></a-plane>
      
      
      <!--------------------------->
      <!---------- MODEL ---------->
      <!--------------------------->
      
      <!-- 3D OBJ model -->
       <a-entity
        obj-model="obj: url(https://cdn.glitch.com/4cfa871f-5082-49ca-9d00-c97e6427df2d%2FInteriorTest.obj); 
                      mtl: url(https://cdn.glitch.com/4cfa871f-5082-49ca-9d00-c97e6427df2d%2FInteriorTest.mtl)"
      >
      </a-entity>
      </a-video>-->
      <a-entity material="shader: flat; src: #tv-video"
                geometry="primitive: plane; width: 1.5; height: 0.8"
                position="0 1.325 -3.92" play-video></a-entity>
      
      <video id="tv-video" 
               autoplay loop="true"
               width="16" height="9"
               src="https://cdn.glitch.com/4cfa871f-5082-49ca-9d00-c97e6427df2d%2Fsamsung.mp4">
               ></video>
      

        
      <!-- 1m Cube -->
<!--       <a-entity scale="1 1 1" position="-91.249 0.025 33.967" rotation="0 0 0" 
                obj-model="obj: url(https://cdn.glitch.com/74753b8c-3f43-4a66-970e-e3735ab68be8%2Fcube.obj?v=1616609417322); 
                           "></a-entity>  -->
        
      <!-- Plane -->
      <a-entity position="0 0.1 0"
        
        material="src: #grid; repeat: 10000 10000; transparent: true; metalness:0.6; roughness: 0.4; sphericalEnvMap: #sky;"></a-entity>
      
      <!-- Lights -->
      <a-entity light="color: #a6a6a6; intensity: 1.0; type: hemisphere; " position="-1.691 18.608 -8.832"></a-entity>
      
    
      
      <!-- Assets --> 
      <a-assets>
       
     
        
        
      <!--------------------------->
      <!---------- PLAYER --------->
      <!--------------------------->
        
        
        <!-- Avatar   -->
        <template id="avatar-template">
          
          <a-entity class="avatar" networked-audio-source="distanceModel: exponential; refDistance: 3; rolloffFactor: 3; maxDistance: 1" >

            <!-- Name tag --> 
            <a-text class="nametag" align="center" scale="1 1 1" position="0 0.5 0.260" rotation="0 180 0" side="double" value="Anonymous"></a-text>

            
            <!-- Video plane!! -->
             <a-plane  color="#FFF" width="4" height="3" position="-0.002 -0.017 0.015" scale="0.15 0.15 0.15"  material="side: back" networked-video-source></a-plane>

            
             <a-entity class="head" scale="0.780 0.900 1.2" position="0 -1.336 0.243" rotation="0 -90 0" 
                obj-model="obj: url(https://cdn.glitch.com/5a14130f-d092-4979-8c5e-e0a0d184a395%2Fjust-head.obj?v=1616172076718);"></a-entity> 
            

            <a-sphere class="body" position="0 -0.5 0.263" rotation="0 0 0" scale="0.28 0.18 0.27" color="#fff"></a-sphere>
            <a-cone class "body" position="0 -0.8 0.27" rotation="0 0 0" height="0.6" radius-bottom="0.2" radius-top="0.28" color="#fff"></a-cone>
            <a-sphere class="body" position="0 -1.1 0.27"  scale="0.2 0.2 0.2"  color="#fff"></a-sphere>          

            </a-entity>
        </template>
      </a-assets>
      

      <!-- Player setup -->
            <a-entity id="player" 
                networked="template:#avatar-template; showLocalTemplate:false; attachTemplateToLocal: true;" 
                camera="fov: 50;"  
                spawn-in-circle="radius:3;" 
                position="12 1.3 0" 
                wasd-controls="fly: false; acceleration: 150;" 
                look-controls 
                kinematic-body
                >
      </a-entity>
      

      
      
    </a-scene>

    
    
    <script>
      // Define custom schema for syncing avatar
      NAF.schemas.add({
        template: '#avatar-template',
        components: [
          'position',
          'rotation',  
          {
            selector: '.nametag',
            component: 'text',
            property: 'value'
          },
          {
            selector: '.head',
            component: 'material',
            property: 'src'
          },
        ]
      });
      


      
      function makeId(length) {
        var text = "";
        var possible = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";
        for (var i = 0; i < length; i++)
          text += possible.charAt(Math.floor(Math.random() * possible.length));

        return text;
      }
      
      
      
      function onSceneLoad() {
        // var username = 'user-' + makeId(5).toLowerCase();
        let possible = ["Koala", "Beer", "Pepsi","Dollar","Grizzly","Parrot","Tzar","Turtle","Cola"]
        var username = possible[Math.floor(Math.random(possible.length)*10)]
        
        
        // Disable for debug...
        username = prompt('Choose a username', username);        
        var player = document.getElementById('player');
        
        var myNametag = player.querySelector('.nametag');
        myNametag.setAttribute('text', 'value', username);
        
        
      
        
        
      }  
      
      
    </script> 
        
   

    
    <script>
    
      
    $( "#location1" ).click(function() {
      $("#player").attr("position","0 1.5 0");
    });
      
    $( "#location2" ).click(function() {
      $("#player").attr("position","0 15 0");
    });

      
      
      
      
      
      $( "#option1-btn" ).click(function() {
        console.log("click1");
        
        // $('#option1').attr("scale","1,1,1");
        // $('#option2').attr("scale","0,0,0");
        
        $('#option1').attr("obj-model","obj: url(https://cdn.glitch.com/74753b8c-3f43-4a66-970e-e3735ab68be8%2Fstep-1.obj?v=1617877396719); mtl: url(https://cdn.glitch.com/74753b8c-3f43-4a66-970e-e3735ab68be8%2Fstep-1.mtl?v=1617877392684)");

        $(this).css('color','#ff6c4b');
        
        $('#option2-btn').css('color','#ffffff');
        $('#option3-btn').css('color','#ffffff');
        $('#option4-btn').css('color','#ffffff');
        $('#option5-btn').css('color','#ffffff');
        
        
      });
      
      $( "#option2-btn" ).click(function() {
        
        $('#option1').attr("obj-model","obj: url(https://cdn.glitch.com/74753b8c-3f43-4a66-970e-e3735ab68be8%2Fstep-2.obj?v=1617877397741); mtl: url(https://cdn.glitch.com/74753b8c-3f43-4a66-970e-e3735ab68be8%2Fstep-2.mtl?v=1617877392716)");
   
        $(this).css('color','#ff6c4b');
        $('#option1-btn').css('color','#ffffff');
        $('#option3-btn').css('color','#ffffff');
        $('#option4-btn').css('color','#ffffff');
        $('#option5-btn').css('color','#ffffff');
  
        
      });
      
      $( "#option3-btn" ).click(function() {

        $('#option1').attr("obj-model","obj: url(https://cdn.glitch.com/74753b8c-3f43-4a66-970e-e3735ab68be8%2Fstep-3.obj?v=1617877398053); mtl: url(https://cdn.glitch.com/74753b8c-3f43-4a66-970e-e3735ab68be8%2Fstep-3.mtl?v=1617877393169)");
        
        $(this).css('color','#ff6c4b');
        $('#option1-btn').css('color','#ffffff');
        $('#option2-btn').css('color','#ffffff');
        $('#option4-btn').css('color','#ffffff');
        $('#option5-btn').css('color','#ffffff');
        
        
      });
      
            $( "#option4-btn" ).click(function() {
        
        $('#option1').attr("obj-model","obj: url(https://cdn.glitch.com/74753b8c-3f43-4a66-970e-e3735ab68be8%2Fstep-4.obj?v=1617877397814); mtl: url(https://cdn.glitch.com/74753b8c-3f43-4a66-970e-e3735ab68be8%2Fstep-4.mtl?v=1617877394500");
        
        $(this).css('color','#ff6c4b');
        $('#option1-btn').css('color','#ffffff');
        $('#option2-btn').css('color','#ffffff');
        $('#option3-btn').css('color','#ffffff');
        $('#option5-btn').css('color','#ffffff');
        
        
      });
      
            $( "#option5-btn" ).click(function() {
        
        $('#option1').attr("obj-model","obj: url(https://cdn.glitch.com/74753b8c-3f43-4a66-970e-e3735ab68be8%2Fstep-5.obj?v=1617877397186); mtl: url(https://cdn.glitch.com/74753b8c-3f43-4a66-970e-e3735ab68be8%2Fstep-5.mtl?v=1617877394179)");
        
        $(this).css('color','#ff6c4b');
        $('#option1-btn').css('color','#ffffff');
        $('#option2-btn').css('color','#ffffff');
        $('#option3-btn').css('color','#ffffff');
        $('#option4-btn').css('color','#ffffff');
        
        
      });
      
    
    var player = document.getElementById('player');
    var avatar = player.querySelector('.avatar');    
    let isOn = false;  
      
    $( ".toggle-btn" ).click(function() {
      if (isOn == false){
        // alert("Set to mute");
        isOn = true;
        // $(this).html("Unmute"); 
        
        const cam = document.getElementById('avatar-template');
        cam.setAttribute('networked-audio-source', 'distanceModel: exponential; refDistance: 0; rolloffFactor: 0; maxDistance: 0');
        
        console.log(cam)
             
      }else{
      
        const cam = document.getElementById('avatar-template');
        cam.setAttribute('networked-audio-source', 'distanceModel: exponential; refDistance: 3; rolloffFactor: 3; maxDistance: 1');
        console.log(cam)
        
        isOn = false;  
        // $(this).html("Mute");
        
      }
    });
      
      
          $( ".toggle-spk" ).click(function() {
        if (isOn == false){
        // alert("Set to mute");
          isOn = true;
          // $(this).html("Speaker on");
        

        
        const cam = document.getElementById('avatar-template');
        cam.setAttribute('networked-audio-source', 'distanceModel: linear; refDistance: 3; rolloffFactor: 3; maxDistance: 1');
        console.log(cam)
        
        
        
      }else{
      
        const cam = document.getElementById('avatar-template');
        cam.setAttribute('networked-audio-source', 'distanceModel: exponential; refDistance: 3; rolloffFactor: 3; maxDistance: 1');
        console.log(cam)
        
        isOn = false;  
        // $(this).html("Speaker off");
        
        
        
      }
    });

      
      
      document.querySelector('a-scene').addEventListener('loaded', onSceneLoad)
            
    </script>

    <script>

      jQuery.fn.clickToggle = function(a, b) {
          return this.on("click", function(ev) { [b, a][this.$_io ^= 1].call(this, ev) })
      };


      
      
      
      
      function micToggle(x) {
        x.classList.toggle("fa-microphone-slash");
      }
      


      $('.toggle-spk').clickToggle(function(ev) {
          $('.fa-bullhorn').css('color',"#ff6c4b"); 
        }, function(ev) {
          $('.fa-bullhorn').css('color',"#ffffff"); 
        });
                                     
           
      
    </script>
  
  </body>
</html>

